OPT=
DEBUG=NODEBUG
DEBUGD=-D$(DEBUG)

CC       = /bgsys/drivers/ppcfloor/gnu-linux/bin/powerpc64-bgq-linux-gcc
MPICC     = mpicc

CFLAGS=  -g $(OPT) $(DEBUGD) -I. -fPIC -Wall
FFLAGS=  -g $(OPT)
LDFLAGS = -g $(OPT)
LIBS = 
C_AR= ar 

ifeq ($(DEBUG),SIONDEBUG)
 CFLAGS += -I../tools/sion_debug
 LIBS += -L../tools/sion_debug -lsiondebug
endif

LDCS_COMMON_OBJS = ldcs_api_util.o ldcs_api.o ldcs_api_listen.o 

all: default 

default: libldcs_socket.a libldcs_socket_wo_wrapper.a libldcs_pipe.a libldcs_pipe_wo_wrapper.a libldcs_shmem.a libldcs_shmem_wo_wrapper.a

libldcs_socket.a : ldcs_api_socket_wrapper.o ldcs_api_socket.o $(LDCS_COMMON_OBJS)
	$(C_AR) $(AFLAG) -rcs $@ ldcs_api_socket_wrapper.o ldcs_api_socket.o $(LDCS_COMMON_OBJS)
	@echo "*** $@ built"

libldcs_socket_wo_wrapper.a : ldcs_api_socket.o $(LDCS_COMMON_OBJS)
	$(C_AR) $(AFLAG) -rcs $@  ldcs_api_socket.o $(LDCS_COMMON_OBJS)
	@echo "*** $@ built"

libldcs_pipe.a : ldcs_api_pipe_wrapper.o ldcs_api_pipe.o ldcs_api_pipe_notify.o $(LDCS_COMMON_OBJS)
	$(C_AR) $(AFLAG) -rcs $@ ldcs_api_pipe_wrapper.o ldcs_api_pipe.o ldcs_api_pipe_notify.o $(LDCS_COMMON_OBJS)
	@echo "*** $@ built"

libldcs_pipe_wo_wrapper.a : ldcs_api_pipe.o $(LDCS_COMMON_OBJS)
	$(C_AR) $(AFLAG) -rcs $@  ldcs_api_pipe.o $(LDCS_COMMON_OBJS)
	@echo "*** $@ built"

libldcs_shmem.a : ldcs_api_shmem_wrapper.o ldcs_api_shmem.o $(LDCS_COMMON_OBJS)
	$(C_AR) $(AFLAG) -rcs $@ ldcs_api_shmem_wrapper.o ldcs_api_shmem.o $(LDCS_COMMON_OBJS)
	@echo "*** $@ built"

libldcs_shmem_wo_wrapper.a : ldcs_api_shmem.o $(LDCS_COMMON_OBJS)
	$(C_AR) $(AFLAG) -rcs $@  ldcs_api_shmem.o $(LDCS_COMMON_OBJS)
	@echo "*** $@ built"

ldcs_api_shmem.o: 	ldcs_api_shmem.c ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_shmem.c	

ldcs_api_socket.o: 	ldcs_api_socket.c ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_socket.c	

ldcs_api_pipe.o: 	ldcs_api_pipe_notify.c ldcs_api_pipe.c ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_pipe.c	

ldcs_api_pipe_wrapper.o: ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_pipe_wrapper.c	

ldcs_api_socket_wrapper.o: ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_socket_wrapper.c	

ldcs_api_shmem_wrapper.o: ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_shmem_wrapper.c	

ldcs_api_pipe_notify.o: 	ldcs_api_pipe_notify.c ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_pipe_notify.c	

ldcs_api_listen.o: 	ldcs_api_listen.c ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api_listen.c	

ldcs_api.o: 	ldcs_api.c ldcs_api.h Makefile
	$(CC) $(CFLAGS) -c  ldcs_api.c	

clean:
	rm -rf *.o *.a  *~ *core*
